BEGIN;
SET search_path TO 'ortools', 'public';
SET client_min_messages TO ERROR;
SELECT plan(18);

CREATE OR REPLACE FUNCTION no_crash()
RETURNS SETOF TEXT AS
$BODY$
DECLARE
params TEXT[];
subs TEXT[];
error_messages TEXT[];
non_empty_args INTEGER[];
BEGIN
    -- por_knapsack
    params = ARRAY[
    '$$SELECT * FROM ortools.knapsack$$',
    'capacity => 15',
    'max_rows => 100000'
    ]::TEXT[];
    subs = ARRAY[
    'NULL',
    'capacity => NULL',
    'max_rows => NULL'
    ]::TEXT[];
    error_messages = ARRAY[
    38000,
    38000,
    ''
    ]::TEXT[];
    non_empty_args = ARRAY[0, 1, 2, 3]::INTEGER[];

    RETURN QUERY SELECT * FROM no_crash_test('por_knapsack', params, subs, error_messages, non_empty_args);

    --por_multiple_knapsack
    params = ARRAY[
    '$$SELECT * FROM ortools.multiple_knapsack$$',
    'capacities => ARRAY[100,100,100,100,100]',
    'max_rows => 100000'
    ]::TEXT[];
    subs = ARRAY[
    'NULL',
    'capacities => NULL',
    'max_rows => NULL'
    ]::TEXT[];
    error_messages = ARRAY[
    38000,
    38000,
    ''
    ]::TEXT[];
    non_empty_args = ARRAY[0, 1, 2, 3]::INTEGER[];

    RETURN QUERY SELECT * FROM no_crash_test('por_multiple_knapsack', params, subs, error_messages, non_empty_args);

    -- bin_packing
    params = ARRAY[
    '$$SELECT * FROM ortools.bin_packing$$',
    'bin_capacity => 100',
    'max_rows => 100000'
    ]::TEXT[];
    subs = ARRAY[
    'NULL',
    'bin_capacity => NULL',
    'max_rows => NULL'
    ]::TEXT[];
    error_messages = ARRAY[
    38000,
    38000,
    ''
    ]::TEXT[];
    non_empty_args = ARRAY[0, 1, 2, 3]::INTEGER[];

    RETURN QUERY SELECT * FROM no_crash_test('por_bin_packing', params, subs, error_messages, non_empty_args);
END
$BODY$
LANGUAGE plpgsql VOLATILE;

SELECT * FROM no_crash();

ROLLBACK;
